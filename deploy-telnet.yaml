apiVersion: apps/v1
kind: Deployment
metadata:
  name: telnet-server
  namespace: devops-admin
  labels:
    app: telnet-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: telnet-server
  template:
    metadata:
      labels:
        app: telnet-server
    spec:
      securityContext:
        runAsUser: 1001
        fsGroup: 1001
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: telnet-server
        # ✅ Use a small Alpine image that includes telnetd and xinetd
        image: alpine:3.19
        command: ["sh", "-c"]
        args:
        - |
          apk add --no-cache busybox-extras xinetd && \
          mkdir -p /etc/xinetd.d && \
          echo "service telnet
          {
              disable         = no
              flags           = REUSE
              socket_type     = stream
              wait            = no
              user            = nobody
              server          = /usr/sbin/in.telnetd
              log_on_failure  += USERID
              port            = 2323
          }" > /etc/xinetd.d/telnet && \
          echo "defaults
          {
              log_type        = SYSLOG authpriv
              log_on_failure  = HOST
              log_on_success  = PID HOST EXIT DURATION
          }
          includedir /etc/xinetd.d" > /etc/xinetd.conf && \
          echo "✅ Telnet server starting on port 2323..." && \
          xinetd -stayalive -dontfork
        ports:
        - containerPort: 2323
          name: telnet
        securityContext:
          allowPrivilegeEscalation: false
          runAsUser: 1001
          runAsGroup: 1001
          capabilities:
            drop: ["ALL"]
        resources:
          requests:
            cpu: "100m"
            memory: "128Mi"
          limits:
            cpu: "200m"
            memory: "256Mi"
        livenessProbe:
          tcpSocket:
            port: 2323
          initialDelaySeconds: 30
          periodSeconds: 30
        readinessProbe:
          tcpSocket:
            port: 2323
          initialDelaySeconds: 10
          periodSeconds: 15
        startupProbe:
          tcpSocket:
            port: 2323
          initialDelaySeconds: 15
          periodSeconds: 10
          failureThreshold: 30
  strategy:
    type: Recreate
---
apiVersion: v1
kind: Service
metadata:
  name: telnet-service
  namespace: devops-admin
spec:
  selector:
    app: telnet-server
  ports:
  - name: telnet
    protocol: TCP
    port: 2323
    targetPort: 2323
  type: ClusterIP













  -----------------------------------------------------------------











  [osuser@bastion ~]$ oc apply -f telnet-server-deploy.yaml
Warning: would violate PodSecurity "restricted:v1.24": runAsNonRoot != true (pod or container "telnet-server" must set securityContext.runAsNonRoot=true)
deployment.apps/telnet-server created
service/telnet-service created
[osuser@bastion ~]$ oc get deploy
NAME            READY   UP-TO-DATE   AVAILABLE   AGE
telnet-server   0/1     0            0           11s
[osuser@bastion ~]$ oc get po
No resources found in devops-admin namespace.
[osuser@bastion ~]$ oc get cm
NAME                       DATA   AGE
istio-ca-root-cert         1      144d
kube-root-ca.crt           1      145d
openshift-service-ca.crt   1      145d
txn-config                 1      140d
[osuser@bastion ~]$ oc get svc
NAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
telnet-service           ClusterIP   172.30.123.39    <none>        2323/TCP   40s
txn-transactionservice   ClusterIP   172.30.216.132   <none>        9081/TCP   140d
[osuser@bastion ~]$ oc describe deploy telnet-server




Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  3m4s  deployment-controller  Scaled up replica set telnet-server-bbf4ccfb5 to 1
[osuser@bastion ~]$
